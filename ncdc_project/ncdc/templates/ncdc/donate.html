{% extends "ncdc/base.html"%}
{% load static %}

{% block title %}Donate - NCDC{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'ncdc/css/donate.css' %}">
<script src="https://checkout.flutterwave.com/v3.js"></script>
{%endblock%}

{% block content %}
<section class="donate-section">
    <div class="donate-container">
        <h1>Support Our Cause</h1>
        <p>Your contribution makes a difference.</p>

        <form id="donation-form">
            <select id="donor-type" name="donor_type" required>
                <option value="" disabled selected>Select Donor Type</option>
                <option value="individual">Individual</option>
                <option value="organization">Organization</option>
            </select>
            <input type="text" id="name" name="name" placeholder="Your Name" required/>
            <input type="email" id="email" name="email" placeholder="Your Email" required/>
            <select id="currency" name="currency" required>
                <option value="" disabled selected>Select Currency</option>
                <option value="USD">USD</option>
                <option value="NGN">NGN</option>
                <option value="EUR">EUR</option>
                <option value="GBP">GBP</option>
            </select>

            <input type="number" id="amount" name="amount" placeholder="Donation Amount" required/>
            <button type="button" id="donate-button">Donate</button>
        </form>
    </div>
</section>

<script>
    document.getElementById("donate-button").addEventListener("click", function () {
    const donorType = document.getElementById("donor-type").value;
    const currency = document.getElementById("currency").value;
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const amount = parseFloat(document.getElementById("amount").value);

    // Validation
    if (!donorType || !currency || !name || !email || isNaN(amount) || amount <= 0) {
        alert("Please fill out all fields correctly.");
        return;
    }

    // Flutterwave payment
    FlutterwaveCheckout({
        public_key: "YOUR_FLUTTERWAVE_PUBLIC_KEY", // Replace with your public key
        tx_ref: `donation_${Date.now()}`,
        amount: amount,
        currency: currency,
        payment_options: "card, mobilemoney, ussd",
        customer: {
            email: email,
            name: name,
        },
        customizations: {
            title: "Donation",
            description: `Donation as a ${donorType}`,
            logo: "YOUR_LOGO_URL", // Replace with your logo URL
        },
        callback: function (data) {
            // Payment successful
            alert("Thank you for your donation!");
            console.log("Payment data:", data);
        },
        onclose: function () {
            // Handle payment closed without completion
            alert("Payment process was not completed.");
        },
    });
});

</script>
{% endblock%}