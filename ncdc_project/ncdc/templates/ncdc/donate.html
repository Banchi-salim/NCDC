{% extends "ncdc/base.html"%}
{% load static %}

{% block title %}Donate - NCDC{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'ncdc/css/donate.css' %}">
<script src="https://checkout.flutterwave.com/v3.js"></script>
{%endblock%}

{% block content %}
    <div class="donate-container">
        <h1>Support Our Cause</h1>
        <p>Your contribution makes a difference.</p>

        <form id="donation-form">
            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" placeholder="Your Name" required>

            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="Your Email" required>

            <label for="amount">Donation Amount</label>
            <input type="number" id="amount" name="amount" placeholder="Enter Amount (NGN)" required>

            <button type="button" id="donate-button">Donate</button>
        </form>
    </div>

    <script>
        document.getElementById('donate-button').addEventListener('click', function (e) {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const amount = document.getElementById('amount').value;

            if (!name || !email || !amount) {
                alert('Please fill out all fields.');
                return;
            }

            FlutterwaveCheckout({
                public_key: 'FLWPUBK_TEST-xxxxxxxxxxxxxxxxxxxxx-X', // Replace with your Flutterwave public key
                tx_ref: 'donation_' + Math.floor(Math.random() * 1000000000 + 1),
                amount: amount,
                currency: 'NGN',
                payment_options: 'card, mobilemoney, ussd',
                customer: {
                    email: email,
                    name: name,
                },
                callback: function (data) {
                    console.log(data);
                    alert('Donation successful. Thank you!');
                    // Redirect to thank-you page or store payment data via a server call
                    fetch('/process-donation/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({
                            transaction_id: data.transaction_id,
                            amount: amount,
                            email: email,
                            name: name
                        })
                    }).then(res => res.json()).then(data => console.log(data));
                },
                onclose: function () {
                    alert('Transaction was not completed. Please try again.');
                },
            });
        });
    </script>
{% endblock%}